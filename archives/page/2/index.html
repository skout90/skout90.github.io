
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="지쳐가는 5분에 인생을 거는 나">
    <title>Archives - 지쳐가는 5분에 인생을 거는 나</title>
    <meta name="author" content="Junho Nam">
    
    
        <link rel="icon" href="https://skout90.github.io/assets/images/favicon.jpg">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/feed.xml">
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="개발 블로그">
<meta property="og:type" content="blog">
<meta property="og:title" content="지쳐가는 5분에 인생을 거는 나">
<meta property="og:url" content="https://skout90.github.io/archives/page/2/index.html">
<meta property="og:site_name" content="지쳐가는 5분에 인생을 거는 나">
<meta property="og:description" content="개발 블로그">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="지쳐가는 5분에 인생을 거는 나">
<meta name="twitter:description" content="개발 블로그">
    
    
        
    
    
        <meta property="og:image" content="https://skout90.github.io/assets/images/favicon.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-sbr8a29vhg2buwqdfiagp9i2fk4rxgm5ip8dz0ru5ozzkfexnn3svxyxd4eg.min.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-102438751-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-102438751-1');
    </script>


    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ "
            aria-label=""
        >
            지쳐가는 5분에 인생을 거는 나
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/favicon.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/favicon.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Junho Nam</h4>
                
                    <h5 class="sidebar-profile-bio"><p>enjoy while living</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/skout90" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://stackoverflow.com/users/5809394" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/06/20/Refactoring/1. 리팩터링-예시/"
                            aria-label=": 1. 예제로 보는 리팩터링 시작해보기"
                        >
                            1. 예제로 보는 리팩터링 시작해보기
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-06-20T19:28:10+09:00">
	
		    2020.06.20
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Refactoring/">Refactoring</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>마틴 파울러가 쓴 리팩터링 책을 읽게 되었다. 코드를 중심으로 예시를 들어 이야기를 풀어나가는데, 처음에 나쁘지 않던 예시코드가 너무나 아름답게 변한 과정이 감탄스러웠다. 그래서 포스팅을 통해 정리 해본다.</p>
<ol>
<li>초기코드</li>
<li>요구사항 소개</li>
<li>리팩터링</li>
<li>요구사항 적용</li>
</ol>
<p>하는 네가지 단계로 정리해보았다.</p>
<h2 id="1-초기-코드"><a href="#1-초기-코드" class="headerlink" title="1. 초기 코드"></a>1. 초기 코드</h2><ul>
<li>plays.json</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"hamlet"</span>: &#123; <span class="string">"name"</span>: <span class="string">"Hamlet"</span>, <span class="string">"type"</span>: <span class="string">"tragedy"</span> &#125;,</span><br><span class="line">  <span class="string">"as-like"</span>: &#123; <span class="string">"name"</span>: <span class="string">"As You Like It"</span>, <span class="string">"type"</span>: <span class="string">"comedy"</span> &#125;,</span><br><span class="line">  <span class="string">"othello"</span>: &#123; <span class="string">"name"</span>: <span class="string">"Othello"</span>, <span class="string">"type"</span>: <span class="string">"tragedy"</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Invoices.json</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"customer"</span>: <span class="string">"BigCo"</span>,</span><br><span class="line">    <span class="string">"performances"</span>: [</span><br><span class="line">      &#123; <span class="string">"playID"</span>: <span class="string">"hamlet"</span>, <span class="string">"audience"</span>: <span class="number">55</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"playID"</span>: <span class="string">"as-like"</span>, <span class="string">"audience"</span>: <span class="number">35</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"playID"</span>: <span class="string">"othello"</span>, <span class="string">"audience"</span>: <span class="number">40</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> INVOICE <span class="keyword">from</span> <span class="string">"../invoices.json"</span>;</span><br><span class="line"><span class="keyword">import</span> PLAYS <span class="keyword">from</span> <span class="string">"../plays.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> totalAmount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> volumeCredits = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;invoice.customer&#125;</span>)\n`</span>;</span><br><span class="line">  <span class="keyword">const</span> format = <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">"en-US"</span>, &#123;</span><br><span class="line">    style: <span class="string">"currency"</span>,</span><br><span class="line">    currency: <span class="string">"USD"</span>,</span><br><span class="line">    minimumFractionDigits: <span class="number">2</span></span><br><span class="line">  &#125;).format;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    <span class="keyword">const</span> play = plays[perf.playID]; <span class="comment">// object &#123;name, type&#125;</span></span><br><span class="line">    <span class="keyword">let</span> thisAmount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (play.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"tragedy"</span>: <span class="comment">//비극</span></span><br><span class="line">        thisAmount = <span class="number">40000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) thisAmount += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"comedy"</span>: <span class="comment">//희극</span></span><br><span class="line">        thisAmount = <span class="number">30000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) thisAmount += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">        thisAmount += <span class="number">300</span> * perf.audience;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;play.type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 포인트를 적립한다.</span></span><br><span class="line">    volumeCredits += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 희극 관객 5명마다 추가 포인트를 제공한다.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"comedy"</span> === play.type) volumeCredits += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 청구 내역을 출력한다.</span></span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;play.name&#125;</span>: <span class="subst">$&#123;format(thisAmount <span class="regexp">/ 100)&#125; ($&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">      perf.audience</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    &#125;석)\n`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    totalAmount += thisAmount;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  result += `총액: $&#123;format(totalAmount /</span> <span class="number">100</span>)&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;volumeCredits&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>결과</p>
<p>청구내역 (고객명: BicCo)<br>    Hamlet: $650.00 (55석)<br>    As You Like It: $580.00 (35석)<br>    Othello: %500.00 (40석)</p>
<p>총액: $1,730.00<br>적립 포인트: 47점</p>
</blockquote>
<p>나쁘지 않은 코드라는 생각이 들었다. 그러나 새로운 요구사항이 들어오면 이야기가 달라진다. 프로그램의 작동 방식을 더 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성한다. 그 뒤 기능을 추가하는 것이 훨씬 수월 한다.</p>
<blockquote>
<p>프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.</p>
</blockquote>
<h2 id="2-추가-요구사항"><a href="#2-추가-요구사항" class="headerlink" title="2. 추가 요구사항"></a>2. 추가 요구사항</h2><p>1) HTML로 출력하라</p>
<ul>
<li>청구결과에 문자열을 추가하는 문장 각각을 조건문으로 감싸야 한다. =&gt; 복잡도가 크게 증가</li>
</ul>
<p>2) 더 많은 장르를 커버</p>
<ul>
<li>공연료와 적립 포인트 계산법에 영향을 줄것 =&gt; 다양한 요구사항을 커버하기 힘들 수 있음</li>
</ul>
<p>(+ 다른 사람이 읽고 이해해야할 일이 있는데 로직을 파악하기 어렵다면..)</p>
<h2 id="3-리팩터링"><a href="#3-리팩터링" class="headerlink" title="3. 리팩터링"></a>3. 리팩터링</h2><h3 id="1-함수추출-함수화-코드-분석-없이도-무슨-일인지-알-수-있도록"><a href="#1-함수추출-함수화-코드-분석-없이도-무슨-일인지-알-수-있도록" class="headerlink" title="1) 함수추출(함수화) : 코드 분석 없이도 무슨 일인지 알 수 있도록!"></a>1) 함수추출(함수화) : 코드 분석 없이도 무슨 일인지 알 수 있도록!</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">  <span class="keyword">const</span> play = plays[perf.playID];</span><br><span class="line">  <span class="keyword">let</span> thisAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//////////////////////////////////////////</span></span><br><span class="line">  <span class="comment">// 아래 switch문은 totalAmount를 계산한다.</span></span><br><span class="line">  <span class="keyword">switch</span> (play.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"tragedy"</span>: <span class="comment">//비극</span></span><br><span class="line">      thisAmount = <span class="number">40000</span>;</span><br><span class="line">      <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) thisAmount += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"comedy"</span>: <span class="comment">//희극</span></span><br><span class="line">      thisAmount = <span class="number">30000</span>;</span><br><span class="line">      <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) thisAmount += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">      thisAmount += <span class="number">300</span> * perf.audience;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;play.type&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 포인트를 적립한다.</span></span><br><span class="line">  volumeCredits += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 희극 관객 5명마다 추가 포인트를 제공한다.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"comedy"</span> === play.type) volumeCredits += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 청구 내역을 출력한다.</span></span><br><span class="line">  result += <span class="string">`<span class="subst">$&#123;play.name&#125;</span>: <span class="subst">$&#123;format(thisAmount <span class="regexp">/ 100)&#125; ($&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  perf.audience</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;석)\n`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  totalAmount += thisAmount;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;</span></span></span></span><br></pre></td></tr></table></figure>

<p>statement() 구문중 <code>switch</code> 코드는, totalAmount를 계산하고 있다. 함수로 추출하는 방식으로 앞서 파악한 정보를 코드에 반영한다. 코드가 하는 일을 설명하는 이름을 짓는다. <code>amountFor(aPerformance)</code></p>
<ul>
<li><p>함수로 빼냈을때 유효 범위를 벗어나는 변수, 새 함수에서는 곧바로 사용할 수 없는 변수가 있는지 확인한다. </p>
<p><code>perf</code>, <code>play</code>는 값이 바뀌지 않으므로, 매개변수로 보내고, <code>thisAmount</code>는 값을 리턴한다.</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf, play</span>) </span>&#123; <span class="comment">// 값이 바뀌지 않는 변수는 매개변수로 전달</span></span><br><span class="line">  <span class="keyword">let</span> thisAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (play.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"tragedy"</span>: <span class="comment">//비극</span></span><br><span class="line">      thisAmount = <span class="number">40000</span>;</span><br><span class="line">      <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) thisAmount += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"comedy"</span>: <span class="comment">//희극</span></span><br><span class="line">      thisAmount = <span class="number">30000</span>;</span><br><span class="line">      <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) thisAmount += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">      thisAmount += <span class="number">300</span> * perf.audience;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;play.type&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> thisAmount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-변수의-이름을-더-명확하게-바꿔보기"><a href="#2-변수의-이름을-더-명확하게-바꿔보기" class="headerlink" title="2) 변수의 이름을 더 명확하게 바꿔보기"></a>2) 변수의 이름을 더 명확하게 바꿔보기</h3><p><code>thisAmount</code>를 <code>result</code>로 변경하여, 변수의 역할을 쉽게 알 수 있다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf, play</span>) </span>&#123; <span class="comment">// 값이 바뀌지 않는 변수는 매개변수로 전달</span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">switch</span> (play.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"tragedy"</span>: <span class="comment">//비극</span></span><br><span class="line">      result = <span class="number">40000</span>;</span><br><span class="line">      <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) result += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"comedy"</span>: <span class="comment">//희극</span></span><br><span class="line">      result = <span class="number">30000</span>;</span><br><span class="line">      <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) result += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">      result += <span class="number">300</span> * perf.audience;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;play.type&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-임시변수를-질의함수로-바꾸기"><a href="#3-임시변수를-질의함수로-바꾸기" class="headerlink" title="3) 임시변수를 질의함수로 바꾸기"></a>3) 임시변수를 질의함수로 바꾸기</h3><h3 id="4-변수-인라인화"><a href="#4-변수-인라인화" class="headerlink" title="4) 변수 인라인화"></a>4) 변수 인라인화</h3><p><code>play</code>변수 제거하기 <code>perf</code>는 for문을 통해 매번 바뀌지만, <code>play</code>변수는 <code>perf</code> 를 통해 얻기 때문에 매개변수로 전달할 필요가 없다. 이런 임시 변수를 제거하면 로컬 범위에 존재하는 이름이 줄어 들어, 추출작업이 편해진다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> plays[aPerf.playID]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>statement내의 중첩함수로 선언하면, 함수 스코프 밖의 plays를 참조할 수 있다.</p>
<blockquote>
<p>외부에서 변수가 변하는 것이 결과에 영향을 주지 않는 순수함수형식도 고려하여 짜면 좋겠다. plays는 다행히 값이 변하지 않기 때문에, 변수로 넘기지 않고 상위 스코프에서 가져다써도 무관할듯 하다.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// plays는 값이 변하지 않기 때문에, 변수로 굳이 넘기지 않았다. </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> plays[aPerf.playID]</span><br><span class="line">  &#125; </span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123; <span class="comment">// play를 제거했다.</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 변수를 인라인화</span></span><br><span class="line">    <span class="keyword">switch</span> (playFor(perf).type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"tragedy"</span>:</span><br><span class="line">        result = <span class="number">40000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) result += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"comedy"</span>:</span><br><span class="line">        result = <span class="number">30000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) result += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">        result += <span class="number">300</span> * perf.audience;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;playFor(perf).type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> totalAmount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> volumeCredits = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;invoice.customer&#125;</span>)\n`</span>;</span><br><span class="line">  <span class="keyword">const</span> format = <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">"en-US"</span>, &#123;</span><br><span class="line">    style: <span class="string">"currency"</span>,</span><br><span class="line">    currency: <span class="string">"USD"</span>,</span><br><span class="line">    minimumFractionDigits: <span class="number">2</span></span><br><span class="line">  &#125;).format;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    <span class="comment">// const play = plays[perf.playID]; =&gt; 인라인된 변수를 제거!!</span></span><br><span class="line">    <span class="comment">// let thisAmount = amountFor(perf, playFor(perf))</span></span><br><span class="line">    </span><br><span class="line">    volumeCredits += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if ("comedy" === play.type) &#123; </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"comedy"</span> === playFor(perf).type) &#123; </span><br><span class="line">      volumeCredits += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 변수를 인라인화</span></span><br><span class="line">    <span class="comment">//result += `$&#123;play.name&#125;: $&#123;format(thisAmount / 100)&#125; ($&#123;perf.audience&#125;석)\n`;</span></span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;playFor(perf).name&#125;</span>: <span class="subst">$&#123;format(amountFor(perf) <span class="regexp">/ 100)&#125; ($&#123;perf.audience&#125;석)\n`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    /</span><span class="regexp">/ totalAmount += thisAmount;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    totalAmount += amountFor(perf);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">	&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  result += `총액: $&#123;format(totalAmount /</span> <span class="number">100</span>)&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;volumeCredits&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<h3 id="5-임시변수-제거-amp-함수-이름-바꾸기"><a href="#5-임시변수-제거-amp-함수-이름-바꾸기" class="headerlink" title="5) 임시변수 제거 &amp; 함수 이름 바꾸기"></a>5) 임시변수 제거 &amp; 함수 이름 바꾸기</h3><ul>
<li>Format</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> format = <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">"en-US"</span>, &#123;</span><br><span class="line">  style: <span class="string">"currency"</span>,</span><br><span class="line">  currency: <span class="string">"USD"</span>,</span><br><span class="line">  minimumFractionDigits: <span class="number">2</span></span><br><span class="line">&#125;).format;</span><br></pre></td></tr></table></figure>

<p>임시변수는 자신의 스코프에서만 의미가 있어, 로직이 길어지며 함수추출도 어렵게 한다.</p>
<p>또한 <code>format</code>은 함수가 하는 일을 충분히 설명해주지 못한다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">"en-US"</span>, &#123;</span><br><span class="line">    style: <span class="string">"currency"</span>,</span><br><span class="line">    currency: <span class="string">"USD"</span>,</span><br><span class="line">    minimumFractionDigits: <span class="number">2</span></span><br><span class="line">	&#125;).format(num/<span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>volumeCreditsFor</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0</span> </span><br><span class="line">  result += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"comedy"</span> === playFor(perf).type) &#123; </span><br><span class="line">    result += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>적용</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> totalAmount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> volumeCredits = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;invoice.customer&#125;</span>)\n`</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    <span class="comment">// 포인트를 적립한다.</span></span><br><span class="line">    volumeCredits += volumeCreditsFor(perf);</span><br><span class="line"></span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;playFor(perf).name&#125;</span>: <span class="subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="subst">$&#123;perf.audience&#125;</span>석)\n`</span>;</span><br><span class="line">    <span class="comment">// totalAmount += thisAmount;</span></span><br><span class="line">    totalAmount += amountFor(perf);</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  result += <span class="string">`총액: <span class="subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;volumeCredits&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<h3 id="6-반복문-쪼개기"><a href="#6-반복문-쪼개기" class="headerlink" title="6) 반복문 쪼개기"></a>6) 반복문 쪼개기</h3><h3 id="7-연관-변수끼리-모으기-문장-슬라이드하기"><a href="#7-연관-변수끼리-모으기-문장-슬라이드하기" class="headerlink" title="7) 연관 변수끼리 모으기(문장 슬라이드하기)"></a>7) 연관 변수끼리 모으기(문장 슬라이드하기)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> volumeCredits = <span class="number">0</span>; <span class="comment">// 변수 선언(초기화)을 반복문 앞으로 이동</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">  volumeCredits += volumeCreditsFor(perf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">  result += <span class="string">`<span class="subst">$&#123;playFor(perf).name&#125;</span>: <span class="subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="subst">$&#123;perf.audience&#125;</span>석)\n`</span>;</span><br><span class="line">  totalAmount += amountFor(perf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>반복문을 쪼개서 성능이 느려지지 않을까 걱정할 수 있지만, 이 정도 중복은 성능에 미치는 영향이 미미할 때가 많다. 게다가 똑똑한 컴파일러들은 최신 캐싱 기법 등으로 무장하고 있어서, 우리의 직관을 초월하는 결과를 내어준다.</p>
<p>하지만 리팩터링이 성능에 상당한 영향을 주기도한다. 그런 경우라도, 저자는 개의치 않고 리팩터링한다. 잘 다듬어진 코드라야 성능 개선 작업도 훨씬 수월하기 때문이다. 리팩터링 과정에서 성능이 크게 떨어졌다면, 리팩터링 후 시간을 내어 성능을 개선한다.</p>
</blockquote>
<p>위에서 배운 <strong>3) 임시변수를 질의함수로 바꾸기</strong> <strong>1) 함수로 추출</strong>  <strong>4) 변수 인라인화</strong> 도 함께 적용해보면</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    result += volumeCreditsFor(perf);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    result += amountFor(perf);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>결과</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;invoice.customer&#125;</span>)\n`</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;playFor(perf).name&#125;</span>: <span class="subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="subst">$&#123;perf.audience&#125;</span>석)\n`</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  result += <span class="string">`총액: <span class="subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;totalVolumeCredits()&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">      result += volumeCreditsFor(perf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">      result += amountFor(perf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">"en-US"</span>, &#123;</span><br><span class="line">      style: <span class="string">"currency"</span>,</span><br><span class="line">      currency: <span class="string">"USD"</span>,</span><br><span class="line">      minimumFractionDigits: <span class="number">2</span></span><br><span class="line">    &#125;).format(num/<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> plays[aPerf.playID]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span> </span><br><span class="line">    result += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"comedy"</span> === playFor(perf).type) &#123; </span><br><span class="line">      result += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (playFor(perf).type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"tragedy"</span>:</span><br><span class="line">        result = <span class="number">40000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) result += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"comedy"</span>:</span><br><span class="line">        result = <span class="number">30000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) result += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">        result += <span class="number">300</span> * perf.audience;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;playFor(perf).type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<h2 id="4-요구사항-html-렌더링-코드-추가"><a href="#4-요구사항-html-렌더링-코드-추가" class="headerlink" title="4. 요구사항 : html 렌더링 코드 추가"></a>4. 요구사항 : html 렌더링 코드 추가</h2><h3 id="8-단계-쪼개기"><a href="#8-단계-쪼개기" class="headerlink" title="8) 단계 쪼개기"></a>8) 단계 쪼개기</h3><p>HTML 버전을 만들기 위해서, 1) 데이터 계산 단계 2) 렌더링 단계 로 나눈다.</p>
<p>우선 <strong>함수 추출하기</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">return</span> renderPlainText(invoice, plays);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderPlainText</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;invoice.customer&#125;</span>)\n`</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;playFor(perf).name&#125;</span>: <span class="subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="subst">$&#123;perf.audience&#125;</span>석)\n`</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  result += <span class="string">`총액: <span class="subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;totalVolumeCredits()&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params"></span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params"></span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">aPerf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<p>계산하는 로직을 분리해야 한다. 두단계 사이 중간 데이터 역할을 할 객체를 만들어서 <code>renderPlainText()</code> 에 인수로 전달한다.</p>
<p>그러면 <code>invoices</code> 와 <code>plays</code> 를 중간 데이터 구조로 옮기면, 계산 관련 코드는 전부 <code>statement()</code>로 모으고, <code>renderPlainText()</code>는 data매개변수로 전달된 데이터만 처리하게 만들 수 있다. 코드로 보자</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">const</span> statementData = &#123;</span><br><span class="line">    customer: invoice.customer,</span><br><span class="line">    performances: invoice.performances</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> renderPlainText(statementData, plays);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderPlainText</span>(<span class="params">data, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;data.customer&#125;</span>)\n`</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> data.performances) &#123;</span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;playFor(perf).name&#125;</span>: <span class="subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="subst">$&#123;perf.audience&#125;</span>석)\n`</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  result += <span class="string">`총액: <span class="subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;totalVolumeCredits()&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params"></span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params"></span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">aPerf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<h3 id="9-함수-옮기기"><a href="#9-함수-옮기기" class="headerlink" title="9) 함수 옮기기"></a>9) 함수 옮기기</h3><p><code>playsFor(perf)</code>, <code>amountFor(perf)</code>, <code>volumeCreditsFor(perf)</code> 도 중간데이터에서 직접 셋팅하게 수정하자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">const</span> statementData = &#123;</span><br><span class="line">    customer: invoice.customer,</span><br><span class="line">    performances: invoice.performances.map(enrichPerformance)</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> renderPlainText(statementData, plays);</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="built_in">Object</span>.assing(&#123;&#125;, aPerf);</span><br><span class="line">    result.play = playFor(result);</span><br><span class="line">    result.amount = amountFor(result);</span><br><span class="line">    result.volumeCredits = volumeCreditsFor(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 함수를 데이터 계산 단계로 이동시켰다.</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">aPerf</span>) </span>&#123;...&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// play를 바로 사용할 수 있다! </span></span><br><span class="line">    <span class="keyword">switch</span> (perf.play.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"tragedy"</span>:</span><br><span class="line">        result = <span class="number">40000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) result += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"comedy"</span>:</span><br><span class="line">        result = <span class="number">30000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) result += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">        result += <span class="number">300</span> * perf.audience;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;perf.play.type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">                           </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span> </span><br><span class="line">    result += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"comedy"</span> === perf.play.type) &#123; </span><br><span class="line">      result += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderPlainText</span>(<span class="params">data, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`청구 내역(고객명: <span class="subst">$&#123;data.customer&#125;</span>)\n`</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> data.performances) &#123;</span><br><span class="line">    result += <span class="string">`<span class="subst">$&#123;perf.play.name&#125;</span>: <span class="subst">$&#123;usd(perf.amount)&#125;</span> (<span class="subst">$&#123;perf.audience&#125;</span>석)\n`</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  result += <span class="string">`총액: <span class="subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;totalVolumeCredits()&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">      <span class="comment">// volumeCredits 바로 사용</span></span><br><span class="line">      result += perf.volumeCredits;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> invoice.performances) &#123;</span><br><span class="line">      <span class="comment">// amount 사용하도록 수정</span></span><br><span class="line">      result += perf.amount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">statement(INVOICE[<span class="number">0</span>], PLAYS);</span><br></pre></td></tr></table></figure>

<p>마지막으로 총합을 구하는 부분 까지 옮기자</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">const</span> statementData = &#123;&#125;;</span><br><span class="line">  statementData.customer = invoice.customer;</span><br><span class="line">  statementData.performances = invoice.performances.map(enrichPerformance);</span><br><span class="line">  statementData.totalAmount = totalAmount(statementData);</span><br><span class="line">  statementData.totalVolumeCredits = totalVolumeCredits(statementData);</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>그리고 이제 <code>statement()</code>에 필요한 데이터 처리에 해당하는 코드를 모두 별도 함수로 빼내자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">statement</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> renderPlainText(createStatementData(invoice, plays));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStatementData</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  result.customer = invoice.customer;</span><br><span class="line">  result.performances = invoice.performances.map(enrichPerformance);</span><br><span class="line">  result.totalAmount = totalAmount(statementData);</span><br><span class="line">  result.totalVolumeCredits = totalVolumeCredits(statementData);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>HTML 버전을 렌더링 하는 코드를 추가해보자!</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlStatement</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> renderHtml(createStatementData(invoice, plays));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderHtml</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">`&lt;h1&gt;청구 내역(고객명: <span class="subst">$&#123;data.customer&#125;</span>)&lt;/h1&gt;\n`</span>;</span><br><span class="line">  result += <span class="string">`&lt;table&gt;\n`</span>;</span><br><span class="line">  result += <span class="string">`&lt;tr&gt;&lt;th&gt;연극&lt;/th&gt;&lt;th&gt;좌석 수&lt;/th&gt;&lt;th&gt;금액&lt;/th&gt;&lt;/tr&gt;`</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> perf <span class="keyword">of</span> data.performances) &#123;</span><br><span class="line">    <span class="comment">// 청구 내역을 출력한다.</span></span><br><span class="line">    result += <span class="string">`&lt;tr&gt;&lt;td&gt;<span class="subst">$&#123;perf.play.name&#125;</span>&lt;/td&gt;&lt;td&gt;(<span class="subst">$&#123;perf.audience&#125;</span>석)&lt;/td&gt;`</span>;</span><br><span class="line">    result += <span class="string">`&lt;td&gt;<span class="subst">$&#123;usd(perf.amount)&#125;</span>&lt;/td&gt;&lt;/tr&gt;\n`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  result += <span class="string">`&lt;/table&gt;\n`</span>;</span><br><span class="line">  result += <span class="string">`총액: <span class="subst">$&#123;usd(data.totalAmount)&#125;</span>\n`</span>;</span><br><span class="line">  result += <span class="string">`적립 포인트: <span class="subst">$&#123;data.totalVolumeCredits&#125;</span>점\n`</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usd를 renderHtml()에서도 사용할 수 있도록 최상위로 옮김</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-요구사항-다양한-장르-커버"><a href="#4-요구사항-다양한-장르-커버" class="headerlink" title="4. 요구사항 :  다양한 장르 커버"></a>4. 요구사항 :  다양한 장르 커버</h2><p>조건부 로직을 포함한 amountFor()와 volumeCreditsFor()를 호출하여 공연료를 계산하는데, 이 두 함수를 전용클래스로 옮기고, 다형성을 이용해서 조건문을 없애보자.</p>
<ul>
<li>원본</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStatementData</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  result.customer = invoice.customer;</span><br><span class="line">  result.performances = invoice.performances.map(enrichPerformance);</span><br><span class="line">  result.totalAmount = totalAmount(statementData);</span><br><span class="line">  result.totalVolumeCredits = totalVolumeCredits(statementData);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="built_in">Object</span>.assing(&#123;&#125;, aPerf);</span><br><span class="line">    result.play = playFor(result);</span><br><span class="line">    result.amount = amountFor(result);</span><br><span class="line">    result.volumeCredits = volumeCreditsFor(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">amountFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (perf.play.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"tragedy"</span>:</span><br><span class="line">        result = <span class="number">40000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">30</span>) result += <span class="number">1000</span> * (perf.audience - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"comedy"</span>:</span><br><span class="line">        result = <span class="number">30000</span>;</span><br><span class="line">        <span class="keyword">if</span> (perf.audience &gt; <span class="number">20</span>) result += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">        result += <span class="number">300</span> * perf.audience;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;perf.play.type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">volumeCreditsFor</span>(<span class="params">perf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span> </span><br><span class="line">    result += <span class="built_in">Math</span>.max(perf.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"comedy"</span> === perf.play.type) &#123; </span><br><span class="line">      result += <span class="built_in">Math</span>.floor(perf.audience / <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>PerformanceCalculator 클래스</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(aPerf, aPlay) &#123;</span><br><span class="line">    <span class="keyword">this</span>.performance = aPerf;</span><br><span class="line">    <span class="keyword">this</span>.play = aPlay;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> calculator = <span class="keyword">new</span> PerformanceCalculator(aPerf, playFor(aPerf));</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">Object</span>.assing(&#123;&#125;, aPerf);</span><br><span class="line">  result.play = playFor(result);</span><br><span class="line">  result.amount = amountFor(result);</span><br><span class="line">  result.volumeCredits = volumeCreditsFor(result);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>함수 옮기기</strong> 기법을 적용해서 계산기 클래스로 옮기자 기존의 <code>performance</code>, <code>play</code> 데이터를 <code>this.performance</code> 와 <code>this.play</code>로 바꿔준다. 그리고 조건문이 들어있는  <code>amountFor()</code> 와 <code>volumeCreditsFor()</code> 함수도 클래스로 이동 시킨다.</p>
<blockquote>
<p>this를 남발 하는 것보다, 만약 this의 값이 변화한다면 변수로 받아 사용하는 것이 코드의 이해에 더 좋을 것이라고 생각한다.(내 생각)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(aPerf, aPlay) &#123;</span><br><span class="line">    <span class="keyword">this</span>.performance = aPerf;</span><br><span class="line">    <span class="keyword">this</span>.play = aPlay;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">this</span>.play.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"tragedy"</span>:</span><br><span class="line">        result = <span class="number">40000</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.performance.audience &gt; <span class="number">30</span>) result += <span class="number">1000</span> * (<span class="keyword">this</span>.performance.audience - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"comedy"</span>:</span><br><span class="line">        result = <span class="number">30000</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.performance.audience &gt; <span class="number">20</span>) result += <span class="number">1000</span> + <span class="number">500</span> * (perf.audience - <span class="number">20</span>);</span><br><span class="line">        result += <span class="number">300</span> * <span class="keyword">this</span>.performance.audience;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`알 수 없는 장르: <span class="subst">$&#123;<span class="keyword">this</span>.play.type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> volumeCredits() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span> </span><br><span class="line">    result += <span class="built_in">Math</span>.max(<span class="keyword">this</span>.performance.audience - <span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"comedy"</span> === <span class="keyword">this</span>.play.type) &#123; </span><br><span class="line">      result += <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.performance.audience / <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> calculator = <span class="keyword">new</span> PerformanceCalculator(aPerf, playFor(aPerf));</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">Object</span>.assing(&#123;&#125;, aPerf);</span><br><span class="line">  result.play = calculator.play;</span><br><span class="line">  result.amount = calculator.amount;</span><br><span class="line">  result.volumeCredits = calculator.volumeCredits;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 다형성을 지원하게 만들어보자. 자바스크립트에서는 생성자가 서브클래스의 인스턴스를 반환할 수 없기 때문에 <strong>생성자를 팩터리 함수로 바꾸기</strong>를 적용한다.</p>
<h3 id="10-생성자를-팩터리-함수로-바꾸기"><a href="#10-생성자를-팩터리-함수로-바꾸기" class="headerlink" title="10) 생성자를 팩터리 함수로 바꾸기"></a>10) 생성자를 팩터리 함수로 바꾸기</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> calculator = createPerformanceCalculator(aPerf, playFor(aPerf));</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">Object</span>.assing(&#123;&#125;, aPerf);</span><br><span class="line">  result.play = calculator.play;</span><br><span class="line">  result.amount = calculator.amount;</span><br><span class="line">  result.volumeCredits = volumeCreditsFor(result);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerformanceCalculator</span>(<span class="params">aPerf, aPlay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(aPlay.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'tragedy'</span>: <span class="keyword">return</span> <span class="keyword">new</span> TragedyCalculator(aPerf, aPlay);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'comedy'</span>: <span class="keyword">return</span> <span class="keyword">new</span> ComedyCalculator(aPerf, aPlay);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-조건부-로직-다형성으로-바꾸기"><a href="#11-조건부-로직-다형성으로-바꾸기" class="headerlink" title="11) 조건부 로직 다형성으로 바꾸기"></a>11) 조건부 로직 다형성으로 바꾸기</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(aPerf, aPlay) &#123;</span><br><span class="line">    <span class="keyword">this</span>.performance = aPerf;</span><br><span class="line">    <span class="keyword">this</span>.play = aPlay;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"서브클래스를 통해서 처리하도록 설계"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> volumeCredits() &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">Math</span>.max(<span class="keyword">this</span>.performance.audience - <span class="number">30</span>, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TragedyCalculator</span> <span class="keyword">extends</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">40000</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.performance.audience &gt; <span class="number">30</span>) &#123;</span><br><span class="line">      result += <span class="number">1000</span> * (<span class="keyword">this</span>.performance.audience - <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComedyCalculator</span> <span class="keyword">extends</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">30000</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.performance.audience &gt; <span class="number">20</span>) &#123;</span><br><span class="line">      result += <span class="number">10000</span> + <span class="number">500</span> * (<span class="keyword">this</span>.performance.audience - <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    result += <span class="number">300</span> * <span class="keyword">this</span>.performance.audience;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> volumeCredits() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.volumeCredits + <span class="built_in">Math</span>.fllor(<span class="keyword">this</span>.performance.audience / <span class="number">5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>amountFor() volumeCreditsFor() 의 조건부 로직을 생성함수 하나로 옮겼다. 같은 타입의 다형성을 기반으로 실행되는 함수가 많을 수록 이렇게 구성하는 쪽이 유리하다!</p>
</blockquote>
<h3 id="결과-코드"><a href="#결과-코드" class="headerlink" title="결과 코드"></a>결과 코드</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStatementData</span>(<span class="params">invoice, plays</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  result.customer = invoice.customer;</span><br><span class="line">  result.performances = invoice.performances.map(enrichPerformance);</span><br><span class="line">  result.totalAmount = totalAmount(statementData);</span><br><span class="line">  result.totalVolumeCredits = totalVolumeCredits(statementData);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">enrichPerformance</span>(<span class="params">aPerf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> calculator = createPerformanceCalculator(aPerf, playFor(aPerf));</span><br><span class="line">    <span class="keyword">const</span> result = <span class="built_in">Object</span>.assing(&#123;&#125;, aPerf);</span><br><span class="line">    result.play = calculator.play;</span><br><span class="line">    result.amount = calculator.amount;</span><br><span class="line">    result.volumeCredits = calculator.volumeCredits;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createPerformanceCalculator</span>(<span class="params">aPerf, aPlay</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(aPlay.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'tragedy'</span>: <span class="keyword">return</span> <span class="keyword">new</span> TragedyCalculator(aPerf, aPlay);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'comedy'</span>: <span class="keyword">return</span> <span class="keyword">new</span> ComedyCalculator(aPerf, aPlay);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">playFor</span>(<span class="params">perf</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">usd</span>(<span class="params">num</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalVolumeCredits</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalAmount</span>(<span class="params">data</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(aPerf, aPlay) &#123;</span><br><span class="line">    <span class="keyword">this</span>.performance = aPerf;</span><br><span class="line">    <span class="keyword">this</span>.play = aPlay;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"서브클래스를 통해서 처리하도록 설계"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> volumeCredits() &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">Math</span>.max(<span class="keyword">this</span>.performance.audience - <span class="number">30</span>, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TragedyCalculator</span> <span class="keyword">extends</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">40000</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.performance.audience &gt; <span class="number">30</span>) &#123;</span><br><span class="line">      result += <span class="number">1000</span> * (<span class="keyword">this</span>.performance.audience - <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComedyCalculator</span> <span class="keyword">extends</span> <span class="title">PerformanceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> amount() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">30000</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.performance.audience &gt; <span class="number">20</span>) &#123;</span><br><span class="line">      result += <span class="number">10000</span> + <span class="number">500</span> * (<span class="keyword">this</span>.performance.audience - <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    result += <span class="number">300</span> * <span class="keyword">this</span>.performance.audience;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> volumeCredits() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.volumeCredits + <span class="built_in">Math</span>.fllor(<span class="keyword">this</span>.performance.audience / <span class="number">5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="쓰인-기법들-정리"><a href="#쓰인-기법들-정리" class="headerlink" title="쓰인 기법들 정리"></a>쓰인 기법들 정리</h2><ol>
<li>함수 추출</li>
<li>변수 이름 명확히 변경</li>
<li>임시변수를 질의함수로 바꾸기</li>
<li>변수 인라인화</li>
<li>함수 이름 바꾸기</li>
<li>반복문 쪼개기</li>
<li>연관 변수끼리 모으기</li>
<li>단계 쪼개기</li>
<li>함수 이동</li>
<li>생성자를 팩터리 함수로 바꾸기</li>
<li>조건부 로직 다형성으로 바꾸기</li>
</ol>
<p>리팩터링을 크게 세단계로 나눠 진행했다.</p>
<ol>
<li>원본함수를 중첩함수 여러 개로 나눴다.</li>
<li>단계 쪼개기를 적용해 계산코드와 출력 코드로 분리했다.</li>
<li>계산 로직을 다형성으로 표현했다.</li>
</ol>
<p>좋은 코드를 가늠하는 기준은 분분하지만, <strong>“수정하기 쉬운 코드”</strong>야 말로 좋은 코드라고 저자는 생각한다. 오류없이 빠르게 수정할 수 있으며, 고객에게 필요한 기능을 더 빠르고 저렴한 비용으로 제공하도록 해준다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>리팩터링 2판: Chaper 01 - 마틴 파울러 저, 남기혁 옮김</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2020/06/20/Refactoring/1. 리팩터링-예시/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/archives/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/archives/page/3/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 2 of 151</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 Junho Nam. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/favicon.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Junho Nam</h4>
        
            <div id="about-card-bio"><p>enjoy while living</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>full stack web developer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Seoul, Korea
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-g4mkxjtcee760xuht66pquch3apo7j5mk6ywfkukd4ko1fduhlhzd6iuikso.min.js"></script>
<!--SCRIPTS END-->
<script type="text/javascript">      
  var search_path = "search.xml";
  if (search_path.length == 0) {
    search_path = "search.xml";
  }
  var path = "/" + search_path;
  searchFunc(path, 'local-search-input', 'local-search-result');
</script>




    </body>
</html>
